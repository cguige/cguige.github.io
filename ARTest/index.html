<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>ar test</title>
<meta name="description" content="">
<meta name="keywords" content="">
<link href="" rel="stylesheet">
<style type="text/css">
	*{ margin: 0; padding: 0; }
	body{ position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: black; }
	#container{ width: 100%; height: 100%; }
</style>

<script type="text/javascript" src="lib/three.min.js"></script>
<script type="text/javascript" src="lib/OBJLoader.js"></script>
<script type="text/javascript" src="lib/OrbitControls.js"></script>
<script type="text/javascript" src="lib/stats.min.js"></script>
<script type="text/javascript" src="lib/SceneBase.js"></script>

</head>
<body onload="init();">
    <div id="container"></div>

	<script type="text/javascript">
		var dom = document.getElementById("container");
		var base = new yu.SceneBase(dom);
		base.setStats();

		function init(){
			
			initObj();

			animate();
		};

		function initObj(){
			var loader = new THREE.OBJLoader();
			loader.load("obj/car.obj", function(object){
				
				var g = object.children[0].geometry;
				g.computeBoundingBox()

				// var m = new THREE.PointsMaterial({ color: "green", size: 0.03 });
				// var m = new THREE.MeshBasicMaterial({ color: 0xffffff });
				var m = new THREE.ShaderMaterial({
					uniforms: {
						color: { value: new THREE.Color("blue") },
						yOffset: { value: g.boundingBox.max.y }
					},
					vertexShader: [
						"uniform float yOffset;",
						"varying vec3 vP;",
						"varying vec3 N;",
						"varying vec2 vUV;",
						"void main(void){",
							"vP = position + vec3(0., yOffset, 0.);",
							"N = normal;",
							"vUV = uv;",
							"gl_Position = projectionMatrix * modelViewMatrix * vec4( vP, 1. );",
						"}"
					].join("\n"),
					fragmentShader: [
						"uniform vec3 color;",
						"varying vec3 vP;",
						"varying vec3 N;",
						"varying vec2 vUV;",
						"void main(void){",
							"vec3 n = normalize(N);",
							"float light = (max( 0.95, dot(n, normalize( vec3(0., 0.8, 1.) ) ) ) - 0.95)/0.05;",
							"float opacity = abs(dot(n, normalize(vec3(0.5, 0.7, 1.4))) );",
							"vec3 uColor = vec3(0., 0.3, 0.3) + color * opacity + vec3( light*light*0.4 );",
							"gl_FragColor = vec4(uColor, opacity);",
						"}"
					].join("\n"),
					transparent: true
				});
				var car = new THREE.Mesh(g,m);
				// var car = new THREE.Points(g,m);
				car.scale.set( 10,10,10 );
				base.scene.add(car);


				// initGround();
			});
		};

		function initGround(){
			var pg = new THREE.PlaneBufferGeometry(1,1);
			var m = new THREE.ShaderMaterial({
				uniform: {
					color: { value: new THREE.Color("blue") }
				},
				vertexShader: [
					"void main(void){",
						"gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.);",
					"}"
				].join("\n"),
				fragmentShader: [
					"uniform vec3 color;",
					"void main(void){",
						"gl_FragColor = vec4(color, 1.);",
					"}"
				].join("\n")
			})
		};

		function animate(){
			base.render();

			requestAnimationFrame(animate);
		}
	</script>
</body>
</html>